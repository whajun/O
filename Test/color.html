<!doctype html>
<html lang="ko" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>색상 접근성 시뮬레이터</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .color-sample {
            transition: all 0.3s ease;
        }
        
        .vision-filter-protanopia {
            filter: url(#protanopia);
        }
        
        .vision-filter-deuteranopia {
            filter: url(#deuteranopia);
        }
        
        .vision-filter-tritanopia {
            filter: url(#tritanopia);
        }
        
        .contrast-indicator {
            position: relative;
        }
        
        .contrast-indicator::after {
            content: attr(data-ratio);
            position: absolute;
            top: -8px;
            right: -8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gray-50 font-sans">
  <svg style="position: absolute; width: 0; height: 0;" aria-hidden="true"><defs><!-- 적록색맹 (Protanopia) -->
    <filter id="protanopia">
     <fecolormatrix type="matrix" values="0.567 0.433 0 0 0
                                                   0.558 0.442 0 0 0
                                                   0 0.242 0.758 0 0
                                                   0 0 0 1 0" />
    </filter> <!-- 녹색맹 (Deuteranopia) -->
    <filter id="deuteranopia">
     <fecolormatrix type="matrix" values="0.625 0.375 0 0 0
                                                   0.7 0.3 0 0 0
                                                   0 0.3 0.7 0 0
                                                   0 0 0 1 0" />
    </filter> <!-- 청색맹 (Tritanopia) -->
    <filter id="tritanopia">
     <fecolormatrix type="matrix" values="0.95 0.05 0 0 0
                                                   0 0.433 0.567 0 0
                                                   0 0.475 0.525 0 0
                                                   0 0 0 1 0" />
    </filter>
   </defs>
  </svg>
  <main class="container mx-auto px-4 py-8 max-w-6xl">
   <header class="text-center mb-8">
    <h1 id="app-title" class="text-3xl font-bold text-gray-800 mb-2">색상 접근성 시뮬레이터</h1>
    <p id="description-text" class="text-gray-600">다양한 시력 장애에 대한 색상 접근성을 확인하세요</p>
   </header><!-- 컨트롤 패널 -->
   <section class="bg-white rounded-lg shadow-md p-6 mb-8">
    <h2 class="text-xl font-semibold mb-4">설정</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
     <div><label for="vision-type" class="block text-sm font-medium text-gray-700 mb-2">시력 상태</label> <select id="vision-type" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"> <option value="normal">정상 시력</option> <option value="protanopia">적색맹 (Protanopia)</option> <option value="deuteranopia">녹색맹 (Deuteranopia)</option> <option value="tritanopia">청색맹 (Tritanopia)</option> </select>
     </div>
     <div><label for="wcag-level" class="block text-sm font-medium text-gray-700 mb-2">WCAG 준수 수준</label> <select id="wcag-level" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"> <option value="AA">WCAG AA (4.5:1)</option> <option value="AAA">WCAG AAA (7:1)</option> </select>
     </div>
     <div><label for="background-color" class="block text-sm font-medium text-gray-700 mb-2">배경색</label> <input type="color" id="background-color" value="#ffffff" class="w-full h-10 border border-gray-300 rounded-md cursor-pointer">
     </div>
    </div> <!-- 기본 색상 팔레트 -->
    <section class="bg-white rounded-lg shadow-md p-6 mb-8">
     <h2 class="text-xl font-semibold mb-4">기본 색상 팔레트</h2>
     <div id="color-palette" class="grid grid-cols-1 md:grid-cols-3 gap-6"><!-- 색상 카드들이 여기에 동적으로 생성됩니다 -->
     </div>
    </section><!-- 사용자 정의 색상 테스트 -->
    <section class="bg-white rounded-lg shadow-md p-6 mb-8">
     <h2 class="text-xl font-semibold mb-4">사용자 정의 색상 테스트</h2>
     <div class="flex flex-wrap gap-4 mb-4">
      <div><label for="custom-color" class="block text-sm font-medium text-gray-700 mb-2">테스트할 색상</label> <input type="color" id="custom-color" value="#3366CC" class="h-10 w-20 border border-gray-300 rounded-md cursor-pointer">
      </div>
      <div class="flex-1 min-w-48"><label for="custom-hex" class="block text-sm font-medium text-gray-700 mb-2">HEX 코드</label> <input type="text" id="custom-hex" value="#3366CC" class="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
      </div>
      <div class="flex items-end"><button id="add-custom-color" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:ring-2 focus:ring-blue-500"> 색상 추가 </button>
      </div>
     </div>
     <div id="custom-colors" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><!-- 사용자 정의 색상들이 여기에 표시됩니다 -->
     </div>
    </section><!-- 접근성 요약 -->
    <section class="bg-white rounded-lg shadow-md p-6">
     <h2 class="text-xl font-semibold mb-4">접근성 요약</h2>
     <div id="accessibility-summary" class="space-y-4"><!-- 접근성 요약이 여기에 표시됩니다 -->
     </div>
    </section>
    <script>
        // 기본 설정
        const defaultConfig = {
            app_title: "색상 접근성 시뮬레이터",
            description_text: "다양한 시력 장애에 대한 색상 접근성을 확인하세요"
        };

        // 기본 색상 팔레트
        const defaultColors = [
            { name: "파란색", hex: "#3366CC", description: "기본 파란색" },
            { name: "주황색", hex: "#FF9900", description: "기본 주황색" },
            { name: "녹색", hex: "#66CC33", description: "기본 녹색" }
        ];

        let customColors = [];
        let currentVisionType = 'normal';
        let currentWcagLevel = 'AA';
        let currentBackground = '#ffffff';

        // 색상 대비 계산 함수
        function getLuminance(hex) {
            const rgb = hexToRgb(hex);
            const [r, g, b] = [rgb.r, rgb.g, rgb.b].map(c => {
                c = c / 255;
                return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
            });
            return 0.2126 * r + 0.7152 * g + 0.0722 * b;
        }

        function getContrastRatio(color1, color2) {
            const lum1 = getLuminance(color1);
            const lum2 = getLuminance(color2);
            const brightest = Math.max(lum1, lum2);
            const darkest = Math.min(lum1, lum2);
            return (brightest + 0.05) / (darkest + 0.05);
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function getWcagCompliance(ratio, level) {
            const threshold = level === 'AAA' ? 7 : 4.5;
            return ratio >= threshold;
        }

        function getComplianceIcon(isCompliant) {
            return isCompliant ? 
                '<span class="text-green-600">✓</span>' : 
                '<span class="text-red-600">✗</span>';
        }

        // 색상 카드 생성 함수
        function createColorCard(color, isCustom = false) {
            const contrastRatio = getContrastRatio(color.hex, currentBackground);
            const isCompliant = getWcagCompliance(contrastRatio, currentWcagLevel);
            const visionClass = currentVisionType !== 'normal' ? `vision-filter-${currentVisionType}` : '';

            return `
                <div class="color-card border border-gray-200 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-medium text-gray-800">${color.name}</h3>
                        ${isCustom ? '<button class="text-red-500 hover:text-red-700 text-sm" onclick="removeCustomColor(\'' + color.hex + '\')">삭제</button>' : ''}
                    </div>
                    <div class="color-sample ${visionClass} w-full h-20 rounded-md mb-3 border border-gray-300 contrast-indicator" 
                         style="background-color: ${color.hex}" 
                         data-ratio="${contrastRatio.toFixed(2)}:1">
                    </div>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span>HEX:</span>
                            <span class="font-mono">${color.hex}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>대비율:</span>
                            <span>${contrastRatio.toFixed(2)}:1</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span>WCAG ${currentWcagLevel}:</span>
                            <span>${getComplianceIcon(isCompliant)} ${isCompliant ? '준수' : '미준수'}</span>
                        </div>
                        <div class="text-xs text-gray-600">
                            ${color.description}
                        </div>
                        ${!isCompliant ? `
                            <div class="mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs">
                                <strong>권장사항:</strong> 더 높은 대비를 위해 ${contrastRatio < 3 ? '더 어둡거나 밝은' : '약간 다른'} 색상을 고려해보세요.
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // UI 업데이트 함수들
        function updateColorPalette() {
            const paletteContainer = document.getElementById('color-palette');
            paletteContainer.innerHTML = defaultColors.map(color => createColorCard(color)).join('');
        }

        function updateCustomColors() {
            const customContainer = document.getElementById('custom-colors');
            customContainer.innerHTML = customColors.map(color => createColorCard(color, true)).join('');
        }

        function updateAccessibilitySummary() {
            const allColors = [...defaultColors, ...customColors];
            const summary = document.getElementById('accessibility-summary');
            
            const compliantColors = allColors.filter(color => 
                getWcagCompliance(getContrastRatio(color.hex, currentBackground), currentWcagLevel)
            );
            
            const totalColors = allColors.length;
            const complianceRate = totalColors > 0 ? (compliantColors.length / totalColors * 100).toFixed(1) : 0;
            
            summary.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-blue-800">총 색상 수</h3>
                        <p class="text-2xl font-bold text-blue-600">${totalColors}</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-green-800">준수 색상</h3>
                        <p class="text-2xl font-bold text-green-600">${compliantColors.length}</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-purple-800">준수율</h3>
                        <p class="text-2xl font-bold text-purple-600">${complianceRate}%</p>
                    </div>
                </div>
                <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-semibold mb-2">현재 설정</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div><strong>시력 상태:</strong> ${getVisionTypeLabel(currentVisionType)}</div>
                        <div><strong>WCAG 수준:</strong> ${currentWcagLevel}</div>
                        <div><strong>배경색:</strong> ${currentBackground}</div>
                    </div>
                </div>
            `;
        }

        function getVisionTypeLabel(type) {
            const labels = {
                'normal': '정상 시력',
                'protanopia': '적색맹',
                'deuteranopia': '녹색맹',
                'tritanopia': '청색맹'
            };
            return labels[type] || type;
        }

        // 사용자 정의 색상 관리
        function addCustomColor() {
            const hexInput = document.getElementById('custom-hex');
            const hex = hexInput.value.trim();
            
            if (!hex.match(/^#[0-9A-Fa-f]{6}$/)) {
                // 인라인 에러 메시지 표시
                showInlineMessage('올바른 HEX 색상 코드를 입력해주세요 (예: #FF0000)', 'error');
                return;
            }
            
            if (customColors.some(color => color.hex.toLowerCase() === hex.toLowerCase())) {
                showInlineMessage('이미 추가된 색상입니다.', 'warning');
                return;
            }
            
            const colorName = `사용자 색상 ${customColors.length + 1}`;
            customColors.push({
                name: colorName,
                hex: hex.toUpperCase(),
                description: '사용자가 추가한 색상'
            });
            
            updateCustomColors();
            updateAccessibilitySummary();
            showInlineMessage('색상이 추가되었습니다!', 'success');
        }

        function removeCustomColor(hex) {
            customColors = customColors.filter(color => color.hex !== hex);
            updateCustomColors();
            updateAccessibilitySummary();
        }

        function showInlineMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
                type === 'warning' ? 'bg-yellow-100 text-yellow-800 border border-yellow-200' :
                'bg-green-100 text-green-800 border border-green-200'
            }`;
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // 이벤트 리스너 설정
        function setupEventListeners() {
            document.getElementById('vision-type').addEventListener('change', (e) => {
                currentVisionType = e.target.value;
                updateColorPalette();
                updateCustomColors();
            });

            document.getElementById('wcag-level').addEventListener('change', (e) => {
                currentWcagLevel = e.target.value;
                updateColorPalette();
                updateCustomColors();
                updateAccessibilitySummary();
            });

            document.getElementById('background-color').addEventListener('change', (e) => {
                currentBackground = e.target.value;
                updateColorPalette();
                updateCustomColors();
                updateAccessibilitySummary();
            });

            document.getElementById('custom-color').addEventListener('change', (e) => {
                document.getElementById('custom-hex').value = e.target.value.toUpperCase();
            });

            document.getElementById('custom-hex').addEventListener('input', (e) => {
                const hex = e.target.value;
                if (hex.match(/^#[0-9A-Fa-f]{6}$/)) {
                    document.getElementById('custom-color').value = hex;
                }
            });

            document.getElementById('add-custom-color').addEventListener('click', addCustomColor);

            // Enter 키로 색상 추가
            document.getElementById('custom-hex').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addCustomColor();
                }
            });
        }

        // Elements SDK 설정
        async function onConfigChange(config) {
            document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
            document.getElementById('description-text').textContent = config.description_text || defaultConfig.description_text;
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["app_title", config.app_title || defaultConfig.app_title],
                ["description_text", config.description_text || defaultConfig.description_text]
            ]);
        }

        // 초기화
        async function init() {
            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange,
                    mapToCapabilities,
                    mapToEditPanelValues
                });
            }

            setupEventListeners();
            updateColorPalette();
            updateCustomColors();
            updateAccessibilitySummary();
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', init);
    </script>
   </section>
  </main>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99675f79e7393109',t:'MTc2MTc5MDE5Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
